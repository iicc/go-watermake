# 图片水印工具使用说明文档

## 目录

1. [项目简介](#项目简介)
2. [环境要求](#环境要求)
3. [编译步骤](#编译步骤)
4. [部署方法](#部署方法)
5. [使用指南](#使用指南)
6. [常见问题](#常见问题)
7. [更新日志](#更新日志)

## 项目简介

这是一个基于 Go 语言开发的图片水印工具，支持以下功能：

* 为单张图片或整个文件夹的图片添加水印
* 水印文字支持随机颜色（默认启用）
* 水印文字带有阴影效果
* 自动将 WebP 格式转换为 JPG 格式
* 批量处理时自动按序号重命名文件

## 环境要求

### 编译环境

* Go 1.19 或更高版本
* 操作系统：Windows、macOS 或 Linux
* 网络连接（用于下载依赖包）

### 运行环境

* 无需安装 Go 环境，编译后的程序可独立运行
* 支持的操作系统：
  * Windows (32 位 / 64 位)
  * macOS (Intel/Apple Silicon)
  * Linux (32 位 / 64 位)

## 编译步骤

### 1. 准备源代码

将以下文件放在同一目录下：

* `watermake.go`（主程序代码）
* `go.mod`（依赖管理文件）
* `go.sum`（依赖列表文件）

### 2. 编译当前系统版本

打开终端 / 命令提示符，导航到源代码目录，执行以下命令：

```
# macOS 或 Linux 系统
go build -o watermark watermake.go

# Windows 系统
go build -o watermark.exe watermake.go
```

编译成功后，会在当前目录生成相应的可执行文件。

## 部署方法

### 本地部署

1. 将编译好的可执行文件（如`watermark.exe`或`watermark`）复制到任意目录
2. （可选）将该目录添加到系统环境变量`PATH`中，以便在任意位置运行

### 服务器部署（Linux）

1. 将编译好的 Linux 版本可执行文件上传到服务器
2. 赋予执行权限：

```
chmod +x watermark
```

3. （可选）将文件移动到系统 PATH 目录：

```
sudo mv watermark /usr/local/bin/
```

## 使用指南

### 基本语法

```
# Windows
watermark.exe [输入路径] [参数]

# macOS/Linux
./watermark [输入路径] [参数]
```

### 常用参数

* `-t`：水印文字内容（默认："Watermark"）
* `-o`：输出路径（文件或文件夹）
* `-p`：水印位置（可选值：top-left, top-right, bottom-left, bottom-right, center，默认：bottom-right）
* `-a`：水印透明度（0-255，默认：128）
* `-s`：字体大小（默认：30）
* `-n`：禁用随机颜色（使用白色）
* `-sox`：阴影 X 轴偏移量（默认：2）
* `-soy`：阴影 Y 轴偏移量（默认：2）
* `-sa`：阴影透明度（0-255，默认：100）

### 示例

1. 处理单张图片：

```
# macOS/Linux
./watermark test_image.jpg -t "我的水印" -p center

# Windows
watermark.exe test_image.jpg -t "我的水印" -p center
```

2. 处理整个文件夹：

```
# macOS/Linux
./watermark ./images -t "批量处理" -s 40

# Windows
watermark.exe .\images -t "批量处理" -s 40
```

## 常见问题

### 1. 编译失败

* 确保 Go 环境已正确安装并配置
* 检查网络连接，确保能访问依赖包仓库
* 尝试删除`go.mod`和`go.sum`文件后重新执行`go mod init watermark`和`go mod tidy`

### 2. 运行时提示 "无法加载字体"

* 程序已优化字体加载逻辑，会自动尝试使用系统中的字体
* 如果仍然遇到问题，可以尝试安装常见字体（如 Arial、黑体等）

### 3. 中文显示乱码

* 程序会优先使用系统中的中文字体
* 确保系统中安装了中文字体（如宋体、黑体、苹方等）

### 4. 权限错误

* 在 Linux/macOS 上处理系统目录时可能需要管理员权限，可尝试添加`sudo`
* 确保输入文件和输出目录有读写权限

## 更新日志

### 最新版本

* 修复了字体加载问题，优化了字体加载逻辑
* 修复了命令行参数解析问题，确保`-t`参数能正确接收带空格的文字
* 增加了详细的调试信息，方便排查问题
* 优化了目录创建逻辑，确保能正确创建输出目录

> （注：文档部分内容由 AI 生成）